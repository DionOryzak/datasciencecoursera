
CASE 
WHEN :damagePremisesRented='None' THEN 0 
WHEN :damagePremisesRentedLimit > 950000 THEN 'Limit too high' 
WHEN :damagePremisesRentedLimit <  50000 THEN 'Limit too low'  
WHEN :damagePremisesRented='Damage To Premises Rented To You' THEN ROUND(a.damagePremisesRentedFactor*bppRate*:damagePremisesRentedLimit/100,0)
WHEN :damagePremisesRented='Broadened Coverage For Damage To Premises Rented To You' THEN ROUND(a.broadenedDamagePremisesRentedFactor*base.bppRate*:damagePremisesRentedLimit/100,0)
END AS damagePremisesRentedLossCost,
ROUND(a.perPersonMedicalExpensesFactor*base.liabilityPremium,0) AS perPersonMedicalExpensesLossCost,


ROUND((offPremisesInterruptionMobileEquipmentOtcFactor+
IF(:offPremisVehicleMobileCollision='Yes',a.offPremisesInterruptionMobileEquipmentCollisionFactor,0))*(1+a.extendedBusinessIncomeFactor+IF(:offPremiseInterruptionVehiclesIncomeNoWaitPeriod='Yes',a.businessIncomeNoWaitingPeriodFactor,0))*(insuranceToExposureFactor1*:offPremiseInterruptionVehiclesLimit1+insuranceToExposureFactor2*:offPremiseInterruptionVehiclesLimit2+insuranceToExposureFactor3*:offPremiseInterruptionVehiclesLimit3)/100 +
(IF(:floodCoverage='Yes',a.endorsementCoveredCauseOfLossFloodFactor,0)+IF(:earthquakeCoinsurance>0,a.endorsementCoveredCauseOfLossEarthquakeFactor,0)+IF(:windstormExlcusion='Yes',a.endorsementCoveredCauseOfLossWindstormExclFactor,0))*offPremisesInterruptionMobileEquipmentOtcFactor*(insuranceToExposureFactor1*:offPremiseInterruptionVehiclesLimit1+insuranceToExposureFactor2*:offPremiseInterruptionVehiclesLimit2+insuranceToExposureFactor3*:offPremiseInterruptionVehiclesLimit3)/100,0)
AS offPremiseInterruptionVehiclesMobileEquipmentLossCost,


(SELECT factor FROM `singleconditions` WHERE `condition`='Damage To Premises Rented To You') AS damagePremisesRentedFactor,
(SELECT factor FROM `singleconditions` WHERE `condition`='Broadened Coverage For Damage To Premises Rented To You') AS broadenedDamagePremisesRentedFactor,
(SELECT factor FROM `mu_ru_perpersonmedicalexpenseslimit` WHERE `limit`=:perPersonMedicalLimit) AS perPersonMedicalExpensesFactor,


(SELECT lossCostPer100 FROM `mu_lc_offpremisesinterruptionofbusinessvehiclesmobileequipment` WHERE `causeOfLoss`='Collision') AS offPremisesInterruptionMobileEquipmentCollisionFactor,
(SELECT lossCostPer100 FROM `mu_lc_offpremisesinterruptionofbusinessvehiclesmobileequipment` WHERE `causeOfLoss`='Other Than Collision') AS offPremisesInterruptionMobileEquipmentOtcFactor,

IF(:offPremiseVehicleMobile='Separate Item Limit',1,(SELECT factor FROM `mu_ru_insurancetoexposure` WHERE `percentageOfInsuranceToExposureFrom`<=(:offPremiseInterruptionVehiclesLimit1/:offPremiseInterruptionVehiclesMaximumPotentialExposure)
AND `percentageOfInsuranceToExposureTo`>(:offPremiseInterruptionVehiclesLimit1/:offPremiseInterruptionVehiclesMaximumPotentialExposure))) AS insuranceToExposureFactor1,

IF(:offPremiseVehicleMobile='Separate Item Limit',1,(SELECT factor FROM `mu_ru_insurancetoexposure` WHERE `percentageOfInsuranceToExposureFrom`<=(:offPremiseInterruptionVehiclesLimit2/:offPremiseInterruptionVehiclesMaximumPotentialExposure)
AND `percentageOfInsuranceToExposureTo`>(:offPremiseInterruptionVehiclesLimit2/:offPremiseInterruptionVehiclesMaximumPotentialExposure))) AS insuranceToExposureFactor2,

IF(:offPremiseVehicleMobile='Separate Item Limit',1,(SELECT factor FROM `mu_ru_insurancetoexposure` WHERE `percentageOfInsuranceToExposureFrom`<=(:offPremiseInterruptionVehiclesLimit3/:offPremiseInterruptionVehiclesMaximumPotentialExposure)
AND `percentageOfInsuranceToExposureTo`>(:offPremiseInterruptionVehiclesLimit3/:offPremiseInterruptionVehiclesMaximumPotentialExposure))) AS insuranceToExposureFactor3,

(SELECT factor FROM `mu_ru_endorsementsmodifyingcoveredcausesoflossfactors` WHERE `endorsement`='Flood Coverage') AS endorsementCoveredCauseOfLossFloodFactor,
(SELECT factor FROM `mu_ru_endorsementsmodifyingcoveredcausesoflossfactors` WHERE `endorsement`='Earthquake And Volcanic Eruption Coverage') AS endorsementCoveredCauseOfLossEarthquakeFactor,
(SELECT factor FROM `mu_ru_endorsementsmodifyingcoveredcausesoflossfactors` WHERE `endorsement`='Windstorm Or Hail Exclusion') AS endorsementCoveredCauseOfLossWindstormExclFactor
(SELECT factor FROM `mu_ru_extendedbusinessincomecoverage` WHERE `numberOfDays`=:offPremiseInterruptionVehiclesExtendedIncomeNumDays) AS extendedBusinessIncomeFactor
(SELECT factor FROM `singleconditions` WHERE `condition`='Business Income Coverage No Waiting Period') AS businessIncomeNoWaitingPeriodFactor




ROUND(IF(:epl='Employment-related Practices Liability Coverage',(LEAST(:numEmployees,25)*eplCostPerEmp.lossCostPerEmpFirst25+GREATEST(0,:numEmployees-25)*eplCostPerEmp.lossCostPerEmpAfter25)*(a.eplLimitFactor-a.eplDeductibleFactor),0) As eplLossCost,
ROUND(a.hiredAutoLossCost*a.hiredAutoLimitFactor,0) AS hiredAutoLossCost,
ROUND(IF(:medicalExpensesExclusion='Yes',-a.medicalExclusionFactor*base.liabilityLossCost,0),0) AS medicalExclusionLossCost,
ROUND(a.additionaInsuredManagerApartmentLossCost*:additionaInsuredManagerApartmentNumber,0) AS additionaInsuredManagerApartmentLossCost,
ROUND(a.additionaInsuredManagerOtherLossCost*:additionaInsuredManagerOtherNumber,0) AS additionaInsuredManagerOtherLossCost,
ROUND(a.additionaInsuredEquipmentApartmentLossCost*:additionaInsuredEquipmentApartmentNumber,0) AS additionaInsuredEquipmentApartmentLossCost,
ROUND(a.additionaInsuredEquipmentOtherLossCost*:additionaInsuredEquipmentOtherNumber,0) AS additionaInsuredEquipmentOtherLossCost,
ROUND((CASE WHEN pharmacistsProfLiab='Professional Liability' THEN a.pharmacistsProfLiabFactor WHEN pharmacistsProfLiab='Broad Professional Liability' THEN pharmacistsBroadProfLiabFactor ELSE 0 END)*base.pharmacistsFactor*liabilityLimit/1000,0) AS pharmacyProfLiabLossCost,
ROUND(:numberVeterinarians*a.veterinariansProfLiabFactor*base.veterinariansFactor,0) AS veterinarianProfLiabLossCost,
ROUND(a.infoSecurityProtectionLossCost*IF(:infoSecurityTier=3 AND :eightHourWaitingPeriod='Yes',eightHourWaitingPeriodFactor,1)*a.infoSecurityBreachContractFactor*(1
	+IF(:infoSecurityOnlineTransactions='Yes',a.infoSecurityOnlineTransactionsFactor,0)
	+IF(:infoSecurityRemoteTransactions='Yes',a.infoSecurityRemoteTransactionsFactor,0)
	+IF(:infoSecurityNoWebsite='Yes',a.infoSecurityNoWebsiteFactor,0)
	+IF(:infoSecurityActiveSocial='Yes',a.infoSecurityActiveSocialFactor,0)
	+IF(:infoSecurityCollectsVisitor='Yes',a.infoSecurityCollectsVisitorFactor,0)
	+IF(:infoSecurityRetainsMinors='Yes',a.infoSecurityRetainsMinorsFactor,0)
	+IF(:infoSecurityMedicalRecords='Yes',a.infoSecurityMedicalRecordsFactor,0)
	+IF(:infoSecurityCreditChecks='Yes',a.infoSecurityCreditChecksFactor,0)
	+IF(:infoSecurityEncryption='Yes',a.infoSecurityEncryptionFactor,0)
	+IF(:infoSecurityHighHazard='Yes',a.infoSecurityHighHazardFactor,0)
)*IF(:paymentCardIndustry='Yes' AND (:infoSecurityTier=2 OR :infoSecurityTier=3),1+a.paymentCardIndustryFactor,1)
*IF(:dishonestActsEmployees='Yes',1+a.dishonestActsEmployeesFactor,1)
,0) AS infoSecurityProtectionLossCost

29.B.7.b.(2)(RF)
(SELECT factor FROM `ca_ru_employmentpracticesliabilityloi` WHERE `limit`=':eplLimit') AS eplLimitFactor,

29.B.7.b.(3)(RF)
(SELECT factor FROM `ca_ru_employmentpracticesliabilitydeductible` WHERE `deductible`=':eplDeductible') AS eplDeductibleFactor,

29.B.7.b.(5)(LC)
(SELECT lossCostPerEmpFirst25, lossCostPerEmpAfter25 FROM `ca_lc_employmentpracticesliability` WHERE `class`=(CASE WHEN classDesc1='Restaurants' OR (LOCATE('mercantile',LOWER(classDesc2)>0 AND LOCATE('mercantile',LOWER(classDesc2)==0) THEN 'Mercantile Restaurant' WHEN LOCATE('distributor',LOWER(CONCAT(classDesc2,classDesc3))>0 THEN 'Wholesale' ELSE 'Other' END)) AS eplCostPerEmp,

29.B.11.c.(1)(LC)
(SELECT factor FROM `mu_lc_hiredautoandnonownedautoliability` WHERE `coverage`=':hiredAutoCoverage') AS hiredAutoLossCost,

29.B.11.c.(2)(RF)
(SELECT factor FROM `mu_ru_hiredautoandnonownedautoliabilityoptionalhigherlimits` WHERE `limit`=':hiredAutoLimit') AS hiredAutoLimitFactor,

29.B.14.c.(RF)
(SELECT factor FROM `singleconditions` WHERE `condition`='Medical Expenses') AS medicalExclusionFactor

29.C.(LC)
(SELECT lossCost FROM `mu_lc_additionalinsured` WHERE `insuredype`='Managers Or Lessors Of Premises' AND riskType = 'Apartment and Office') AS additionaInsuredManagerApartmentLossCost,
(SELECT lossCost FROM `mu_lc_additionalinsured` WHERE `insuredype`='Managers Or Lessors Of Premises' AND riskType = 'All Other') AS additionaInsuredManagerOtherLossCost,
(SELECT lossCost FROM `mu_lc_additionalinsured` WHERE `insuredype`='Lessor Of Leased Equipment' AND riskType = 'Apartment and Office') AS additionaInsuredEquipmentApartmentLossCost,
(SELECT lossCost FROM `mu_lc_additionalinsured` WHERE `insuredype`='Lessor Of Leased Equipment' AND riskType = 'All Other') AS additionaInsuredEquipmentOtherLossCost,

29.D.3.e.(1)(c)(i)(LC)
(SELECT factor FROM `singleconditions` WHERE `condition`='Pharmacists Professional Liability') AS pharmacistsProfLiabFactor

29.D.3.e.(2)(c)(i)(LC)
(SELECT factor FROM `singleconditions` WHERE `condition`='Pharmacists Broad Professional Liability') AS pharmacistsBroadProfLiabFactor

29.D.3.g.(5)(LC)
(SELECT factor FROM `singleconditions` WHERE `condition`='Veterinarians Professional Liability') AS veterinariansProfLiabFactor

29.E.1.g.(3)(LC)
(SELECT lossCost FROM `ca_lc_informationsecurityprotection` WHERE `tier`=':infoSecurityTier' AND `limit`=':infoSecurityLimit' AND `deductible`=':infoSecurityDeductible') AS infoSecurityProtectionLossCost,

29.E.1.g.(4)(RF)
(SELECT factor FROM `singleconditions` WHERE `condition`='Eight-hour Waiting Period') AS eightHourWaitingPeriodFactor

29.E.1.g.(5)(RF)
(SELECT factor FROM `mu_ru_securitybreachservicescontract` WHERE `contract`=:infoSecurityBreachContract) AS infoSecurityBreachContractFactor, 

29.E.1.g.(6)(RF)
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured conducts online transactions') AS infoSecurityOnlineTransactionsFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Remote access to insured's computer system(s) is granted to authorized third parties (employees, customers and/or business partners)') AS infoSecurityRemoteTransactionsFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured does not have a website') AS infoSecurityNoWebsiteFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured has active social media profiles') AS infoSecurityActiveSocialFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured collects data from customers or visitors to their website(s) that is required by law to be protected') AS infoSecurityCollectsVisitorFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured collects and retains information on minors') AS infoSecurityRetainsMinorsFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured utilizes medical records in daily business') AS infoSecurityMedicalRecordsFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured utilizes background and/or credit checks in daily business and retains this information') AS infoSecurityCreditChecksFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='Insured employs encryption in customer communications') AS infoSecurityEncryptionFactor, 
(SELECT factor FROM `mu_ru_riskcharacteristics` WHERE `riskCharacteristics`='High Hazard Classifications') AS infoSecurityHighHazardFactor, 

29.E.1.i.(3)(RF)
(SELECT factor FROM `singleconditions` WHERE `condition`='Payment Card Industry Coverage') AS paymentCardIndustryFactor

29.E.1.j.(3)(RF)
(SELECT factor FROM `singleconditions` WHERE `condition`='Dishonest, Malicious Or Fraudulent Acts Committed By Employees Coverage Factor') AS dishonestActsEmployeesFactor
